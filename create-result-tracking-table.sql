-- Create BMM_RESULT_TRACKINGS table
CREATE TABLE BMM_RESULT_TRACKINGS (
    ID VARCHAR2(36) NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    DELETED_AT TIMESTAMP,
    CREATED_BY VARCHAR2(50),
    UPDATED_BY VARCHAR2(50),
    VERSION NUMBER NOT NULL,
    SERVICE_REQUEST_ID VARCHAR2(36) NOT NULL,
    RESULT_STATUS_ID VARCHAR2(36) NOT NULL,
    REQUEST_ROOM_ID VARCHAR2(36),
    IN_ROOM_ID VARCHAR2(36),
    SAMPLE_TYPE_ID VARCHAR2(36),
    SAMPLE_CODE VARCHAR2(50),
    IN_TRACKING_TIME TIMESTAMP,
    OUT_TRACKING_TIME TIMESTAMP,
    NOTE VARCHAR2(1000),
    
    CONSTRAINT PK_BMM_RESULT_TRACKINGS PRIMARY KEY (ID),
    CONSTRAINT FK_BMM_RT_SERVICE_REQ FOREIGN KEY (SERVICE_REQUEST_ID) REFERENCES BMM_SERVICE_REQUESTS(ID),
    CONSTRAINT FK_BMM_RT_RESULT_STATUS FOREIGN KEY (RESULT_STATUS_ID) REFERENCES BMM_RESULT_STATUSES(ID),
    CONSTRAINT FK_BMM_RT_REQUEST_ROOM FOREIGN KEY (REQUEST_ROOM_ID) REFERENCES BMM_ROOMS(ID),
    CONSTRAINT FK_BMM_RT_IN_ROOM FOREIGN KEY (IN_ROOM_ID) REFERENCES BMM_ROOMS(ID),
    CONSTRAINT FK_BMM_RT_SAMPLE_TYPE FOREIGN KEY (SAMPLE_TYPE_ID) REFERENCES BMM_SAMPLE_TYPES(ID)
);

-- Create Indexes for BMM_RESULT_TRACKINGS
CREATE INDEX IDX_BMM_RT_SR_ID ON BMM_RESULT_TRACKINGS(SERVICE_REQUEST_ID);
CREATE INDEX IDX_BMM_RT_STATUS_ID ON BMM_RESULT_TRACKINGS(RESULT_STATUS_ID);
CREATE INDEX IDX_BMM_RT_REQUEST_ROOM_ID ON BMM_RESULT_TRACKINGS(REQUEST_ROOM_ID);
CREATE INDEX IDX_BMM_RT_IN_ROOM_ID ON BMM_RESULT_TRACKINGS(IN_ROOM_ID);
CREATE INDEX IDX_BMM_RT_SAMPLE_TYPE_ID ON BMM_RESULT_TRACKINGS(SAMPLE_TYPE_ID);
CREATE INDEX IDX_BMM_RT_SAMPLE_CODE ON BMM_RESULT_TRACKINGS(SAMPLE_CODE);
CREATE INDEX IDX_BMM_RT_IN_TIME ON BMM_RESULT_TRACKINGS(IN_TRACKING_TIME);
CREATE INDEX IDX_BMM_RT_OUT_TIME ON BMM_RESULT_TRACKINGS(OUT_TRACKING_TIME);
CREATE INDEX IDX_BMM_RT_SR_STATUS ON BMM_RESULT_TRACKINGS(SERVICE_REQUEST_ID, RESULT_STATUS_ID);
CREATE INDEX IDX_BMM_RT_CREATED_AT ON BMM_RESULT_TRACKINGS(CREATED_AT);

-- Insert sample data (assuming we have existing service requests, result statuses, and rooms)
-- Note: These are sample UUIDs - replace with actual IDs from your system

-- Sample tracking for a service request
INSERT INTO BMM_RESULT_TRACKINGS (
    ID, 
    SERVICE_REQUEST_ID, 
    RESULT_STATUS_ID, 
    REQUEST_ROOM_ID, 
    IN_ROOM_ID,
    SAMPLE_TYPE_ID,
    SAMPLE_CODE,
    IN_TRACKING_TIME, 
    OUT_TRACKING_TIME, 
    NOTE, 
    VERSION
) VALUES (
    '550e8400-e29b-41d4-a716-446655440010',
    '550e8400-e29b-41d4-a716-446655440000', -- Sample service request ID
    '550e8400-e29b-41d4-a716-446655440001', -- PENDING status
    '550e8400-e29b-41d4-a716-446655440000', -- Request room ID
    '550e8400-e29b-41d4-a716-446655440001', -- In room ID
    '550e8400-e29b-41d4-a716-446655440000', -- Sample type ID
    'BLD-2024-001', -- Sample code
    CURRENT_TIMESTAMP - INTERVAL '2' HOUR,
    NULL,
    'Sample started processing',
    1
);

-- Sample completed tracking
INSERT INTO BMM_RESULT_TRACKINGS (
    ID, 
    SERVICE_REQUEST_ID, 
    RESULT_STATUS_ID, 
    REQUEST_ROOM_ID, 
    IN_ROOM_ID,
    SAMPLE_TYPE_ID,
    SAMPLE_CODE,
    IN_TRACKING_TIME, 
    OUT_TRACKING_TIME, 
    NOTE, 
    VERSION
) VALUES (
    '550e8400-e29b-41d4-a716-446655440011',
    '550e8400-e29b-41d4-a716-446655440001', -- Sample service request ID
    '550e8400-e29b-41d4-a716-446655440003', -- COMPLETED status
    '550e8400-e29b-41d4-a716-446655440001', -- Request room ID
    '550e8400-e29b-41d4-a716-446655440002', -- In room ID
    '550e8400-e29b-41d4-a716-446655440001', -- Sample type ID
    'BLD-2024-002', -- Sample code
    CURRENT_TIMESTAMP - INTERVAL '3' HOUR,
    CURRENT_TIMESTAMP - INTERVAL '1' HOUR,
    'Sample processing completed successfully',
    1
);

COMMIT;
