-- Migration: Add missing fields to BMM_RESULT_TRACKINGS table
-- Date: 2025-10-23
-- Description: Add workflow, timeline, and business rules fields to ResultTracking entity

-- Add new columns to BMM_RESULT_TRACKINGS
ALTER TABLE BMM_RESULT_TRACKINGS ADD (
    WORKFLOW CLOB,
    TIMELINE CLOB,
    BUSINESS_RULES CLOB,
    ASSIGNED_TO VARCHAR2(36),
    PRIORITY VARCHAR2(20) DEFAULT 'NORMAL',
    ESTIMATED_COMPLETION_TIME TIMESTAMP
);

-- Add comments for new columns
COMMENT ON COLUMN BMM_RESULT_TRACKINGS.WORKFLOW IS 'Workflow information in JSON format';
COMMENT ON COLUMN BMM_RESULT_TRACKINGS.TIMELINE IS 'Timeline information in JSON format';
COMMENT ON COLUMN BMM_RESULT_TRACKINGS.BUSINESS_RULES IS 'Business rules in JSON format';
COMMENT ON COLUMN BMM_RESULT_TRACKINGS.ASSIGNED_TO IS 'User ID assigned to this tracking';
COMMENT ON COLUMN BMM_RESULT_TRACKINGS.PRIORITY IS 'Priority level: LOW, NORMAL, HIGH, URGENT';
COMMENT ON COLUMN BMM_RESULT_TRACKINGS.ESTIMATED_COMPLETION_TIME IS 'Estimated completion time';

-- Create indexes for new columns
CREATE INDEX IDX_BMM_RT_PRIORITY ON BMM_RESULT_TRACKINGS(PRIORITY);
CREATE INDEX IDX_BMM_RT_ASSIGNED_TO ON BMM_RESULT_TRACKINGS(ASSIGNED_TO);
CREATE INDEX IDX_BMM_RT_ESTIMATED_COMPLETION ON BMM_RESULT_TRACKINGS(ESTIMATED_COMPLETION_TIME);

-- Update existing records to have default values
UPDATE BMM_RESULT_TRACKINGS SET PRIORITY = 'NORMAL' WHERE PRIORITY IS NULL;
